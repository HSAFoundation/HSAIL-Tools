set(HSAILASM $<TARGET_FILE:HSAILasm>)
if (MSVC)
  set(RUNTEST ${CMAKE_CURRENT_SOURCE_DIR}/run_test.cmd)
else()
  set(RUNTEST ${CMAKE_CURRENT_SOURCE_DIR}/run_test)
endif()

macro(instruction_test name)
  add_test(NAME instruction/${name}
           COMMAND ${RUNTEST} ${HSAILASM} ${name} ${CMAKE_CURRENT_SOURCE_DIR}
           WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
endmacro()

instruction_test(CORE-base-large-1_0)
instruction_test(CORE-base-small-1_0)
instruction_test(CORE-full-large-1_0)
instruction_test(CORE-full-small-1_0)
instruction_test(IMAGE-base-large-1_0)
instruction_test(IMAGE-base-small-1_0)
instruction_test(IMAGE-full-large-1_0)
instruction_test(IMAGE-full-small-1_0)
instruction_test(amd_gcn-base-large-1_0)
instruction_test(amd_gcn-base-small-1_0)
instruction_test(amd_gcn-full-large-1_0)
instruction_test(amd_gcn-full-small-1_0)
instruction_test(amd_mipmap-base-large-1_0)
instruction_test(amd_mipmap-base-small-1_0)
instruction_test(amd_mipmap-full-large-1_0)
instruction_test(amd_mipmap-full-small-1_0)
